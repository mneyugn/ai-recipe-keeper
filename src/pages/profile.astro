---
import AppLayout from "../layouts/AppLayout.astro";
import { ProfileContainer } from "../components/ProfileContainer";
// server-side auth check (middleware already checked authentication)
const { locals } = Astro;
const supabase = locals.supabase;
const user = locals.user;

// middleware already redirects unauthenticated users
const userId = user?.id;

if (!userId) {
  return Astro.redirect("/auth/login");
}

// verify user exists and is active
const { data: dbUser } = await supabase.from("users").select("id, email").eq("id", userId).single();
if (!dbUser) {
  // user not found in database, redirect to login
  return Astro.redirect("/login");
}

export const prerender = false;
---

<AppLayout title="Profil uÅ¼ytkownika">
  <ProfileContainer client:load />
</AppLayout>
